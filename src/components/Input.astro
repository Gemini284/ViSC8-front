---
---

<style>
    .wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 300px;
        margin: 80px auto 0;
        background: transparent;
        border: 2px solid rgba(0, 0, 0, 0.2);
        padding: 30px 40px;
        border-radius: 10px;
        backdrop-filter: blur(20px);
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    h2 {
        color: #78CAD5;
        font-size: 1.5em;
    }

    .button {
        background-color: hsl(278, 77%, 74%, .2);
        color: white;
        border: none;
        border-radius: 8px;
        margin-top: 20px;
        padding: 10px 20px;
    }

    .input {
        border: 1px solid black;
        border-radius: 100px;
        text-align: center;
        margin-bottom: 20px;
        margin-top: 20px;
        width: 95%;
    }

    .image-container {
        margin-top: 20px;
        text-align: center;
    }

    .image-container img {
        max-width: 100%;
        width: 150px; /* Adjust this value to control the width of the image */
        height: 150px;
        border-radius: 10px;
    }

    img {
        width: 500px;
        height: 500px;
        position: absolute;
    }
</style>

<div id="container" class="small-form">
    <form class="wrapper" id="imageForm" method="POST">
        <h2>Favor de insertar el link para el an√°lisis</h2>
        <input name="shingeSumare" type="url" placeholder="Url" required class="input" id="imageUrl">
        <button class="button" type="submit">Submit</button>
    </form>
    <div class="image-container" id="imageContainer"></div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const imageForm: HTMLFormElement = document.getElementById("imageForm") as HTMLFormElement;
        if(imageForm){
            imageForm.addEventListener("submit", async(event): Promise<void> => {
                event.preventDefault();

                const formData: FormData = new FormData(imageForm);
                const urlForm: FormDataEntryValue = formData.get("shingeSumare") as FormDataEntryValue;
                console.log(urlForm);

                try{
                    const response: Response = await fetch("http://localhost:8083/Analize", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ url: urlForm })
                    });

                    if(response.ok){
                        const blob = await response.blob();
                        const imageUrl = URL.createObjectURL(blob);

                        const imageContainer: HTMLDivElement = document.getElementById("imageContainer") as HTMLDivElement;
                        imageContainer.innerHTML = `<img src="${imageUrl}" alt="Analyzed Image" />`;
                    }else{
                        console.error("Error en la solicitud:", response.statusText);
                    }
                }catch(error){
                    console.error("Error en la solicitud:", error);
                }
            });
        }
    });
</script>
